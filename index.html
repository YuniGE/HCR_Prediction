<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Threshold Prediction Dashboard (+7% Safety Buffer)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        :root {
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --accent: #0066cc;
            --success: #34c759;
            --warning: #ff9f0a;
            --danger: #ff3b30;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            padding-bottom: 60px;
        }
        
        .nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .nav-content {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 20px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            font-weight: 500;
        }
        
        .hero {
            text-align: center;
            padding: 80px 20px 50px;
            background: linear-gradient(180deg, #f5f5f7 0%, #ffffff 100%);
        }
        
        h1 {
            font-size: 48px;
            font-weight: 600;
            letter-spacing: -0.005em;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .subtitle {
            font-size: 21px;
            font-weight: 400;
            color: var(--text-secondary);
            margin-bottom: 20px;
            letter-spacing: 0.009em;
        }
        
        .buffer-badge {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .control-panel {
            margin-bottom: 40px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .select-wrapper {
            position: relative;
            display: inline-block;
        }
        
        select {
            appearance: none;
            -webkit-appearance: none;
            background-color: transparent;
            border: none;
            font-size: 28px;
            font-weight: 600;
            color: var(--accent);
            cursor: pointer;
            text-align: center;
            padding-right: 30px;
            padding-left: 10px;
        }
        
        .select-arrow {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-40%);
            pointer-events: none;
            color: var(--accent);
            font-size: 16px;
            font-weight: 700;
        }
        
        select:focus { outline: none; }
        
        .chart-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.06);
            margin-bottom: 40px;
            transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        
        .chart-card:hover {
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-top: 40px;
            padding-top: 40px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        
        .metric {
            text-align: center;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .metric-value.highlight {
            color: var(--success);
        }
        
        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .info-box {
            background: #f0f9ff;
            border-left: 4px solid var(--accent);
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .info-box h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 8px;
        }
        
        .info-box p {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .footer {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 60px;
            padding-top: 20px;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate {
            animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
        }
        
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        
    </style>
</head>
<body>
    <div class="nav">
        <div class="nav-content">
            <span style="font-weight: 600;">ðŸŽ“ HKU Research Intelligence</span>
            <span>Threshold Model v3.1 (+7% Safety Buffer)</span>
        </div>
    </div>

    <div class="hero">
        <div class="buffer-badge animate">+7% Safety Buffer | 90% Confidence</div>
        <h1 class="animate delay-1">Safe Targets. Defined.</h1>
        <p class="subtitle animate delay-2">ESI Threshold Predictions with Data-Driven Safety Margin</p>
    </div>

    <div class="container">
        <div class="control-panel animate delay-3">
            <div class="select-wrapper">
                <select id="fieldSelect" onchange="updateDashboard()">
                    <option value="AGRICULTURAL SCIENCES">AGRICULTURAL SCIENCES</option><option value="BIOLOGY & BIOCHEMISTRY">BIOLOGY & BIOCHEMISTRY</option><option value="CHEMISTRY">CHEMISTRY</option><option value="CLINICAL MEDICINE">CLINICAL MEDICINE</option><option value="COMPUTER SCIENCE">COMPUTER SCIENCE</option><option value="ECONOMICS & BUSINESS">ECONOMICS & BUSINESS</option><option value="ENGINEERING">ENGINEERING</option><option value="ENVIRONMENT/ECOLOGY">ENVIRONMENT/ECOLOGY</option><option value="GEOSCIENCES">GEOSCIENCES</option><option value="IMMUNOLOGY">IMMUNOLOGY</option><option value="MATERIALS SCIENCE">MATERIALS SCIENCE</option><option value="MATHEMATICS">MATHEMATICS</option><option value="MICROBIOLOGY">MICROBIOLOGY</option><option value="MOLECULAR BIOLOGY & GENETICS">MOLECULAR BIOLOGY & GENETICS</option><option value="NEUROSCIENCE & BEHAVIOR">NEUROSCIENCE & BEHAVIOR</option><option value="PHARMACOLOGY & TOXICOLOGY">PHARMACOLOGY & TOXICOLOGY</option><option value="PHYSICS">PHYSICS</option><option value="PLANT & ANIMAL SCIENCE">PLANT & ANIMAL SCIENCE</option><option value="PSYCHIATRY/PSYCHOLOGY">PSYCHIATRY/PSYCHOLOGY</option><option value="SOCIAL SCIENCES, GENERAL">SOCIAL SCIENCES, GENERAL</option><option value="SPACE SCIENCE">SPACE SCIENCE</option>
                </select>
                <span class="select-arrow">â–¼</span>
            </div>
        </div>

        <div class="chart-card animate delay-3">
            <div id="mainChart" style="height: 500px;"></div>
            
            <div class="metrics-grid">
                <div class="metric">
                    <span id="maeMetric" class="metric-value">0.0</span>
                    <span class="metric-label">Mean Abs. Error</span>
                </div>
                <div class="metric">
                    <span id="bufferMetric" class="metric-value highlight">+7%</span>
                    <span class="metric-label">Safety Buffer</span>
                </div>
                <div class="metric">
                    <span id="yearsMetric" class="metric-value">0</span>
                    <span class="metric-label">Publication Years</span>
                </div>
                <div class="metric">
                    <span id="accMetric" class="metric-value">High</span>
                    <span class="metric-label">Model Confidence</span>
                </div>
            </div>
            
            <div class="info-box">
                <h3>Understanding the Thresholds</h3>
                <p>
                    <strong style="color: #0071e3;">Safe Threshold (blue)</strong> = Predicted x 1.07. If citations exceed this, the paper is <strong>definitely HCP</strong> (~90% confidence).<br>
                    <strong style="color: #34c759;">Predicted Threshold (green dotted)</strong> = Model's estimate of the actual threshold.
                </p>
            </div>
        </div>
        
        <p style="text-align: center; color: #86868b; font-size: 14px; margin-top: 20px;">
            Comparing predicted thresholds against actual ESI values for papers published 2014-2024.<br>
            Test data: March 2025 ESI Release.
        </p>
    </div>
    
    <div class="footer">
        Copyright Â© 2025 HKU HCR Prediction Project. All rights reserved.<br>
        Model Version: v3.1 | Buffer Strategy: +7% (90% Confidence)
    </div>

    <script>
        const data = {"AGRICULTURAL SCIENCES": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [185, 183, 166, 161, 151, 137, 121, 89, 53, 28, 9], "predicted": [180.9, 174.5, 162.2, 155.4, 147.0, 130.8, 114.3, 87.9, 54.4, 27.2, 7.9], "safety_line": [193.6, 186.7, 173.6, 166.3, 157.3, 140.0, 122.3, 94.1, 58.2, 29.1, 8.5], "errors": [-4.1, -8.5, -3.8, -5.6, -4.0, -6.2, -6.7, -1.1, 1.4, -0.8, -1.1], "mae": 3.94, "buffer_pct": 7.000000000000001}, "BIOLOGY & BIOCHEMISTRY": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [303, 272, 258, 236, 218, 195, 162, 110, 66, 35, 10], "predicted": [297.0, 273.8, 250.1, 230.4, 211.5, 187.2, 158.7, 112.7, 67.9, 33.1, 9.4], "safety_line": [317.8, 293.0, 267.6, 246.5, 226.3, 200.3, 169.8, 120.6, 72.7, 35.4, 10.1], "errors": [-6.0, 1.8, -7.9, -5.6, -6.5, -7.8, -3.3, 2.7, 1.9, -1.9, -0.6], "mae": 4.18, "buffer_pct": 7.000000000000001}, "CHEMISTRY": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [272, 268, 240, 231, 214, 190, 166, 124, 80, 45, 14], "predicted": [267.5, 262.7, 238.7, 222.7, 207.5, 183.5, 158.5, 123.7, 81.4, 42.4, 11.9], "safety_line": [286.2, 281.1, 255.4, 238.3, 222.0, 196.3, 169.6, 132.4, 87.1, 45.4, 12.7], "errors": [-4.5, -5.3, -1.3, -8.3, -6.5, -6.5, -7.5, -0.3, 1.4, -2.6, -2.1], "mae": 4.21, "buffer_pct": 7.000000000000001}, "CLINICAL MEDICINE": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [233, 230, 219, 209, 186, 157, 147, 95, 56, 30, 8], "predicted": [232.1, 223.0, 213.2, 200.4, 183.3, 156.6, 138.8, 99.9, 59.7, 29.5, 7.2], "safety_line": [248.3, 238.6, 228.1, 214.4, 196.1, 167.6, 148.5, 106.9, 63.9, 31.6, 7.7], "errors": [-0.9, -7.0, -5.8, -8.6, -2.7, -0.4, -8.2, 4.9, 3.7, -0.5, -0.8], "mae": 3.95, "buffer_pct": 7.000000000000001}, "COMPUTER SCIENCE": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [198, 178, 179, 191, 177, 167, 155, 111, 66, 38, 12], "predicted": [193.3, 177.0, 171.6, 182.0, 173.0, 159.9, 146.1, 111.5, 70.0, 36.2, 10.4], "safety_line": [206.8, 189.4, 183.6, 194.7, 185.1, 171.1, 156.3, 119.3, 74.9, 38.7, 11.1], "errors": [-4.7, -1.0, -7.4, -9.0, -4.0, -7.1, -8.9, 0.5, 4.0, -1.8, -1.6], "mae": 4.55, "buffer_pct": 7.000000000000001}, "ECONOMICS & BUSINESS": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [251, 226, 208, 201, 168, 148, 137, 103, 67, 34, 9], "predicted": [241.7, 221.0, 199.9, 192.0, 165.1, 140.1, 125.9, 102.3, 65.1, 33.2, 9.6], "safety_line": [258.6, 236.5, 213.9, 205.4, 176.7, 149.9, 134.7, 109.5, 69.7, 35.5, 10.3], "errors": [-9.3, -5.0, -8.1, -9.0, -2.9, -7.9, -11.1, -0.7, -1.9, -0.8, 0.6], "mae": 5.21, "buffer_pct": 7.000000000000001}, "ENGINEERING": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [187, 186, 180, 181, 174, 154, 137, 111, 71, 40, 12], "predicted": [184.7, 179.9, 175.2, 171.7, 166.5, 150.2, 130.4, 107.1, 71.8, 39.3, 11.4], "safety_line": [197.6, 192.5, 187.5, 183.7, 178.2, 160.7, 139.5, 114.6, 76.8, 42.1, 12.2], "errors": [-2.3, -6.1, -4.8, -9.3, -7.5, -3.8, -6.6, -3.9, 0.8, -0.7, -0.6], "mae": 4.22, "buffer_pct": 7.000000000000001}, "ENVIRONMENT/ECOLOGY": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [327, 305, 270, 252, 228, 193, 166, 121, 69, 38, 11], "predicted": [316.4, 298.4, 269.7, 244.1, 220.6, 190.7, 159.9, 121.5, 75.1, 36.2, 10.1], "safety_line": [338.5, 319.3, 288.6, 261.2, 236.0, 204.0, 171.1, 130.0, 80.4, 38.7, 10.8], "errors": [-10.6, -6.6, -0.3, -7.9, -7.4, -2.3, -6.1, 0.5, 6.1, -1.8, -0.9], "mae": 4.59, "buffer_pct": 7.000000000000001}, "GEOSCIENCES": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [244, 222, 201, 181, 157, 142, 120, 82, 55, 30, 9], "predicted": [247.7, 221.5, 198.2, 175.0, 155.0, 134.5, 115.9, 83.4, 54.9, 29.1, 8.5], "safety_line": [265.0, 237.0, 212.1, 187.2, 165.9, 143.9, 124.0, 89.2, 58.7, 31.1, 9.1], "errors": [3.7, -0.5, -2.8, -6.0, -2.0, -7.5, -4.1, 1.4, -0.1, -0.9, -0.5], "mae": 2.68, "buffer_pct": 7.000000000000001}, "IMMUNOLOGY": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [365, 314, 285, 260, 253, 230, 264, 145, 80, 38, 10], "predicted": [358.6, 319.3, 287.1, 257.4, 237.8, 220.5, 244.7, 153.9, 89.0, 40.9, 7.9], "safety_line": [383.7, 341.7, 307.2, 275.4, 254.4, 235.9, 261.8, 164.7, 95.2, 43.8, 8.5], "errors": [-6.4, 5.3, 2.1, -2.6, -15.2, -9.5, -19.3, 8.9, 9.0, 2.9, -2.1], "mae": 7.57, "buffer_pct": 7.000000000000001}, "MATERIALS SCIENCE": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [359, 339, 330, 311, 291, 243, 204, 150, 99, 57, 17], "predicted": [351.9, 334.6, 321.7, 299.6, 281.6, 243.1, 198.4, 151.8, 100.4, 51.8, 15.6], "safety_line": [376.5, 358.0, 344.2, 320.6, 301.3, 260.1, 212.3, 162.4, 107.4, 55.4, 16.7], "errors": [-7.1, -4.4, -8.3, -11.4, -9.4, 0.1, -5.6, 1.8, 1.4, -5.2, -1.4], "mae": 5.1, "buffer_pct": 7.000000000000001}, "MATHEMATICS": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [88, 88, 77, 72, 69, 61, 52, 37, 26, 15, 5], "predicted": [86.6, 83.9, 78.0, 70.7, 66.9, 59.7, 51.1, 38.4, 26.7, 15.4, 5.1], "safety_line": [92.7, 89.8, 83.5, 75.6, 71.6, 63.9, 54.7, 41.1, 28.6, 16.5, 5.5], "errors": [-1.4, -4.1, 1.0, -1.3, -2.1, -1.3, -0.9, 1.4, 0.7, 0.4, 0.1], "mae": 1.34, "buffer_pct": 7.000000000000001}, "MICROBIOLOGY": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [276, 249, 270, 249, 227, 192, 225, 113, 62, 30, 9], "predicted": [269.8, 248.9, 249.7, 245.6, 222.5, 189.4, 204.7, 129.7, 63.8, 30.5, 5.7], "safety_line": [288.7, 266.3, 267.2, 262.8, 238.1, 202.7, 219.0, 138.8, 68.3, 32.6, 6.1], "errors": [-6.2, -0.1, -20.3, -3.4, -4.5, -2.6, -20.3, 16.7, 1.8, 0.5, -3.3], "mae": 7.25, "buffer_pct": 7.000000000000001}, "MOLECULAR BIOLOGY & GENETICS": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [472, 429, 387, 340, 368, 300, 264, 163, 112, 56, 14], "predicted": [471.3, 430.8, 387.4, 342.2, 345.8, 298.7, 250.5, 172.4, 106.8, 55.3, 11.0], "safety_line": [504.3, 461.0, 414.5, 366.2, 370.0, 319.6, 268.0, 184.5, 114.3, 59.2, 11.8], "errors": [-0.7, 1.8, 0.4, 2.2, -22.2, -1.3, -13.5, 9.4, -5.2, -0.7, -3.0], "mae": 5.49, "buffer_pct": 7.000000000000001}, "NEUROSCIENCE & BEHAVIOR": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [293, 269, 246, 241, 213, 169, 139, 92, 57, 29, 8], "predicted": [294.5, 268.5, 242.9, 231.8, 210.2, 171.6, 137.5, 95.5, 56.9, 28.5, 7.7], "safety_line": [315.1, 287.3, 259.9, 248.0, 224.9, 183.6, 147.1, 102.2, 60.9, 30.5, 8.2], "errors": [1.5, -0.5, -3.1, -9.2, -2.8, 2.6, -1.5, 3.5, -0.1, -0.5, -0.3], "mae": 2.33, "buffer_pct": 7.000000000000001}, "PHARMACOLOGY & TOXICOLOGY": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [208, 195, 183, 175, 165, 141, 126, 88, 58, 30, 8], "predicted": [206.2, 190.7, 179.8, 168.1, 159.3, 139.6, 117.0, 89.9, 57.6, 29.1, 8.1], "safety_line": [220.6, 204.0, 192.4, 179.9, 170.5, 149.4, 125.2, 96.2, 61.6, 31.1, 8.7], "errors": [-1.8, -4.3, -3.2, -6.9, -5.7, -1.4, -9.0, 1.9, -0.4, -0.9, 0.1], "mae": 3.24, "buffer_pct": 7.000000000000001}, "PHYSICS": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [216, 204, 190, 173, 162, 142, 119, 92, 60, 34, 11], "predicted": [209.0, 198.7, 185.8, 168.7, 154.5, 136.9, 114.7, 89.8, 60.9, 31.9, 9.9], "safety_line": [223.6, 212.6, 198.8, 180.5, 165.3, 146.5, 122.7, 96.1, 65.2, 34.1, 10.6], "errors": [-7.0, -5.3, -4.2, -4.3, -7.5, -5.1, -4.3, -2.2, 0.9, -2.1, -1.1], "mae": 4.0, "buffer_pct": 7.000000000000001}, "PLANT & ANIMAL SCIENCE": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [176, 165, 148, 134, 119, 107, 89, 61, 37, 21, 7], "predicted": [173.9, 161.8, 148.1, 131.0, 117.3, 102.3, 86.5, 61.4, 37.8, 19.3, 6.0], "safety_line": [186.1, 173.1, 158.5, 140.2, 125.5, 109.5, 92.6, 65.7, 40.4, 20.7, 6.4], "errors": [-2.1, -3.2, 0.1, -3.0, -1.7, -4.7, -2.5, 0.4, 0.8, -1.7, -1.0], "mae": 1.93, "buffer_pct": 7.000000000000001}, "PSYCHIATRY/PSYCHOLOGY": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [249, 224, 198, 196, 159, 127, 130, 78, 39, 19, 6], "predicted": [246.2, 221.7, 196.6, 186.2, 160.7, 128.3, 118.8, 81.0, 43.3, 19.5, 5.6], "safety_line": [263.4, 237.2, 210.4, 199.2, 171.9, 137.3, 127.1, 86.7, 46.3, 20.9, 6.0], "errors": [-2.8, -2.3, -1.4, -9.8, 1.7, 1.3, -11.2, 3.0, 4.3, 0.5, -0.4], "mae": 3.52, "buffer_pct": 7.000000000000001}, "SOCIAL SCIENCES, GENERAL": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [164, 149, 134, 129, 116, 98, 95, 68, 40, 20, 6], "predicted": [159.8, 147.8, 132.7, 122.6, 113.0, 96.0, 88.6, 68.6, 42.2, 19.7, 6.0], "safety_line": [171.0, 158.1, 142.0, 131.2, 120.9, 102.7, 94.8, 73.4, 45.2, 21.1, 6.4], "errors": [-4.2, -1.2, -1.3, -6.4, -3.0, -2.0, -6.4, 0.6, 2.2, -0.3, 0.0], "mae": 2.51, "buffer_pct": 7.000000000000001}, "SPACE SCIENCE": {"years": [2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024], "actual": [275, 275, 244, 225, 215, 179, 143, 96, 66, 50, 14], "predicted": [276.6, 265.5, 240.4, 216.9, 200.4, 175.5, 138.9, 99.7, 64.4, 42.3, 15.6], "safety_line": [296.0, 284.1, 257.2, 232.1, 214.4, 187.8, 148.6, 106.7, 68.9, 45.3, 16.7], "errors": [1.6, -9.5, -3.6, -8.1, -14.6, -3.5, -4.1, 3.7, -1.6, -7.7, 1.6], "mae": 5.42, "buffer_pct": 7.000000000000001}};
        
        function updateDashboard() {
            const field = document.getElementById('fieldSelect').value;
            const fieldData = data[field];
            
            // Update Metrics
            document.getElementById('maeMetric').innerText = fieldData.mae;
            document.getElementById('yearsMetric').innerText = fieldData.years.length;
            document.getElementById('accMetric').innerText = fieldData.mae < 5 ? "Very High" : (fieldData.mae < 10 ? "High" : "Moderate");
            
            // Chart Plotting
            const traceActual = {
                x: fieldData.years,
                y: fieldData.actual,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Actual Threshold',
                line: { color: '#1d1d1f', width: 4, shape: 'spline' },
                marker: { size: 12, color: '#1d1d1f', line: {color: 'white', width: 2} }
            };
            
            const traceSafeThreshold = {
                x: fieldData.years,
                y: fieldData.safety_line,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Safe Threshold (+7%)',
                line: { color: '#0071e3', width: 3, shape: 'spline' },
                marker: { size: 10, color: '#0071e3', symbol: 'circle', opacity: 0.9 }
            };
            
            const tracePredicted = {
                x: fieldData.years,
                y: fieldData.predicted,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Predicted Threshold',
                line: { color: '#34c759', width: 2, dash: 'dot', shape: 'spline' },
                marker: { size: 8, color: '#34c759', symbol: 'diamond', opacity: 0.8 }
            };

            const layout = {
                font: { family: '-apple-system, BlinkMacSystemFont, sans-serif' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                showlegend: true,
                legend: { 
                    orientation: 'h', 
                    y: 1.08, 
                    x: 0.5, 
                    xanchor: 'center',
                    font: { size: 14, color: '#86868b' }
                },
                margin: { t: 60, r: 20, l: 60, b: 60 },
                xaxis: { 
                    title: 'Publication Year',
                    gridcolor: '#f5f5f7',
                    tickmode: 'linear',
                    showline: false,
                    zeroline: false,
                    tickfont: { size: 14, color: '#86868b' }
                },
                yaxis: { 
                    title: 'Citations Required',
                    gridcolor: '#f5f5f7',
                    showline: false,
                    zeroline: false,
                    tickfont: { size: 14, color: '#86868b' }
                },
                hovermode: 'x unified',
                hoverlabel: {
                    bgcolor: 'white',
                    bordercolor: 'rgba(0,0,0,0.1)',
                    font: { family: '-apple-system, sans-serif' }
                }
            };
            
            Plotly.react('mainChart', [traceActual, traceSafeThreshold, tracePredicted], layout, {displayModeBar: false});
        }
        
        // Initialize
        updateDashboard();
        
        // Add resize listener
        window.addEventListener('resize', () => {
            const update = { width: document.getElementById('mainChart').offsetWidth };
            Plotly.relayout('mainChart', update);
        });
    </script>
</body>
</html>
